{% extends "page.html" %}

{% block content %}

{% if programme|length > 0 and date in dates_with_movies %}
<ul class="teaser" aria-label="Filmer">
    {% for movie in programme|filter(movie => movie.shows|filter(show =>
    date(show.showStart|format_datetime(pattern="dd-MM-y")) == date(date))) %}
    <li>
        <img src="/assets/images/{{ movie.mainVersionId }}.webp" aria-hidden="true" height="225" width="150"
            loading="lazy" alt="">
        <h2>{{ movie.title }}</h2>
        {% set showsToday = movie.shows|filter(show => date(show.showStart|date("d-m-Y")) == date(date)) %}
        {% if showsToday|length > 0 %}
        <ul class="shows-today" aria-label="Forestillinger">
            {% for show in showsToday %}
            <li class="{{ date(" now"|date("d-m-Y H:i"))> date(show.showStart|date("d-m-Y H:i")) ? 'past' : '' }}">
                {% if date("now"|date("d-m-Y H:i")) > date(show.showStart|date("d-m-Y H:i")) %}
                <time datetime="{{ show.showStart|date(" c") }}">{{ show.showStart|date("H:i") }}</time>
                {% elseif show.ticketSaleUrl %}
                <a href="{{ show.ticketSaleUrl }}" rel="noreferrer" target="_blank">
                    <time datetime="{{ show.showStart|date(" c") }}">{{ show.showStart|date("H:i") }}</time>
                </a>
                {% else %}
                <time datetime="{{ show.showStart|date(" c") }}">{{ show.showStart|date("H:i") }}</time>
                {% endif %}
                <p><span>{{ show.screenName }}</span></p>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </li>
    {% endfor %}
</ul>

{% elseif dates_with_movies|length > 0 %}
<div class="error">
    <p>Ingen filmer på programmet her i dag!</p>
    <ul>
        <li>Prøv gjerne en annen dag</li>
        {% for date in dates_with_movies %}
        <li>
            <a href="/{{ location_slug }}/{{ date }}">{{ date|format_date(pattern="EEEE d'.' MMMM", locale="no",
                timezone="GMT+1") }}</a>
        </li>
        {% endfor %}
    </ul>
</div>

{% else %}
<div class="error">
    <p>{{ location_name }} har ingen filmer på programmet – som vi vet om, i alle fall!</p>
</div>
{% endif %}
{% endblock %}
